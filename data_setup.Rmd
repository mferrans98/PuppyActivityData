---
title: "Activity Data Setup"
author: "Morgan Ferrans"
date: "10/28/2021"
output: html_document
---

---
output:
  html_document: rmarkdown::github_document
---
ACTIVITY MONITOR DATA (Updated 20211102)
```{r}
knitr::opts_chunk$set(echo = TRUE, 
                        eval = FALSE)
```
 
#DATA SETUP
---
Load packages and import data
```{r, cache=TRUE}
library(readxl)    
library(tidyverse)
library(dplyr)
library(clock)
library(lubridate)
library(hms)
library(ggplot2)
load(file = "activitygraphsenv.RData")
```

```{r, eval=FALSE}
##IMPORT the data
setwd('~/Desktop')
sheets <- readxl::excel_sheets('puppies2.xlsx')
activity_df <- do.call(rbind, lapply(sheets, function(X) transform(readxl::read_excel('puppies2.xlsx', sheet = X), sheetname = X)))
activity_df<-activity_df %>% mutate(time=as_hms(activity_df$Time)) %>% na.omit() %>%  select(-sheetname,-Time)
activity_df$Date <- as.Date(activity_df$Date, format= "%Y-%m-%d")
```


Removing dates where collar is off
```{r,cache=TRUE, eval=FALSE}
#removing dates where collar is off
  #Anya
filtered_dates <- activity_df[!(activity_df$Dog.name == "Anya" & activity_df$Date < "2019-10-02")&!(activity_df$Dog.name == "Anya" & activity_df$Date == "2019-10-16")&!(activity_df$Dog.name == "Anya" & activity_df$Date > "2020-11-18"),]
  #Aries
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Aries" & filtered_dates$Date < "2019-10-02")&!(filtered_dates$Dog.name == "Aries" & filtered_dates$Date == "2019-10-16")&!(filtered_dates$Dog.name == "Aries" & filtered_dates$Date > "2020-11-18"),]
  #Weston
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Weston" & filtered_dates$Date < "2019-10-02")&!(filtered_dates$Dog.name == "Weston" & filtered_dates$Date == "2019-10-16")&!(filtered_dates$Dog.name == "Weston" & filtered_dates$Date > "2020-11-18"),]
  #Ying
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Ying" & filtered_dates$Date < "2019-10-02")&!(filtered_dates$Dog.name == "Ying" & filtered_dates$Date == "2019-10-16")&!(filtered_dates$Dog.name == "Ying" & filtered_dates$Date > "2020-11-18"),]
  #Yolanda
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Yolanda" & filtered_dates$Date < "2019-10-02")&!(filtered_dates$Dog.name == "Yolanda" & filtered_dates$Date == "2019-10-16")&!(filtered_dates$Dog.name == "Yolanda" & filtered_dates$Date > "2019-11-18"),]
  #Zax
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Zax" & filtered_dates$Date < "2019-10-02")&!(filtered_dates$Dog.name == "Zax" & filtered_dates$Date == "2019-10-16")&!(filtered_dates$Dog.name == "Zax" & filtered_dates$Date > "2019-11-18"),]
  #Zina
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Zina" & filtered_dates$Date < "2019-10-02")&!(filtered_dates$Dog.name == "Zina" & filtered_dates$Date == "2019-10-16")&!(filtered_dates$Dog.name == "Zina" & filtered_dates$Date > "2019-11-18"),]
  #Arthur
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Arthur" & filtered_dates$Date < "2020-2-08")&!(filtered_dates$Dog.name == "Arthur" & filtered_dates$Date > "2020-03-10"),]
  #Aurora
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Aurora" & filtered_dates$Date < "2020-2-08")&!(filtered_dates$Dog.name == "Aurora" & filtered_dates$Date > "2020-03-10"),]
  #Westley
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Westley" & filtered_dates$Date < "2020-2-01")&!(filtered_dates$Dog.name == "Westley" & filtered_dates$Date > "2020-03-10"),]
  #Wisdom
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Wisdom" & filtered_dates$Date < "2020-2-01")&!(filtered_dates$Dog.name == "Wisdom" & filtered_dates$Date > "2020-03-10"),]
  #Yonder
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Yonder" & filtered_dates$Date < "2020-2-06")&!(filtered_dates$Dog.name == "Yonder" & filtered_dates$Date > "2020-03-10"),]
  #Zindel
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Zindel" & filtered_dates$Date < "2020-2-06")&!(filtered_dates$Dog.name == "Zindel" & filtered_dates$Date > "2020-03-10"),]
  #Zola
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Zola" & filtered_dates$Date < "2020-2-06")&!(filtered_dates$Dog.name == "Zola" & filtered_dates$Date > "2020-03-10"),]
  #Barley
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Barley" & filtered_dates$Date < "2020-8-06")&!(filtered_dates$Dog.name == "Barley" & filtered_dates$Date > "2020-09-30"),]
  #Kristoff
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Kristoff" & filtered_dates$Date < "2020-07-24")&!(filtered_dates$Dog.name == "Kristoff" & filtered_dates$Date > "2020-09-22"),]
  #Sparky
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Sparky" & filtered_dates$Date < "2020-10-08")&!(filtered_dates$Dog.name == "Sparky" & filtered_dates$Date > "2020-12-15"),]
  #Sassy
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Sassy" & filtered_dates$Date < "2020-10-08")&!(filtered_dates$Dog.name == "Sassy" & filtered_dates$Date > "2020-12-14"),]
  #Stanley
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Stanley" & filtered_dates$Date < "2020-10-08")&!(filtered_dates$Dog.name == "Stanley" & filtered_dates$Date > "2020-12-15"),]
  #Rainbow
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Rainbow" & filtered_dates$Date < "2020-10-08")&!(filtered_dates$Dog.name == "Rainbow" & filtered_dates$Date > "2020-12-07"),]
  #Jack
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Jack" & filtered_dates$Date < "2021-02-06")&!(filtered_dates$Dog.name == "Jack" & filtered_dates$Date > "2021-04-19"),]
  #Lily
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Lily" & filtered_dates$Date < "2021-2-06")&!(filtered_dates$Dog.name == "Lily" & filtered_dates$Date > "2021-04-20"),]
  #Leo
filtered_dates <- filtered_dates[!(filtered_dates$Dog.name == "Leo" & filtered_dates$Date < "2021-2-06")&!(filtered_dates$Dog.name == "Leo" & filtered_dates$Date > "2021-04-19"),]

```
Rename columns
```{r, cache=TRUE, eval=FALSE}
#renamecolumns
filtered_dates<-rename(filtered_dates, "name"=Dog.name)
filtered_dates<-rename(filtered_dates, activity_counts="Activity.Data")
```
Delete sleeping hours (10pm-8am)
```{r, cache=TRUE, eval=FALSE}
#delete sleeping hours (10pm-8am)
filtered_datetime<- filtered_dates %>% filter(hour(time)>7)
filtered_datetime<- filtered_datetime %>% filter(hour(time)<23)
```
Adding DOB, weeks old, rearing (home vs DPK), & sex columns 
```{r, cache=TRUE, eval=FALSE}
#addingDOB
newdf<-filtered_datetime %>% mutate(DOB =
                     case_when(name == "Anya" ~ "2019-06-29",
                               name == "Aries" ~ "2019-06-29",
                                name == "Weston" ~ "2019-06-26",
                                name == "Ying" ~ "2019-06-27",
                                name == "Yolanda" ~ "2019-06-27",
                                name == "Zina" ~ "2019-06-28",
                                name == "Zax" ~ "2019-06-28",
                                name == "Arthur" ~ "2019-12-12",
                                name == "Aurora" ~ "2019-12-12",
                                name == "Westley" ~ "2019-12-06",
                                name == "Wisdom" ~ "2019-12-06",
                                name == "Yonder" ~ "2019-12-11",
                                name == "Zola" ~ "2019-12-11",
                                name == "Zindel" ~ "2019-12-11",
                                name == "Kristoff" ~ "2020-05-05",
                                name == "Barley" ~ "2020-05-06",
                                name == "Rainbow" ~ "2020-08-02",
                                name == "Sassy" ~ "2020-08-12",
                                name == "Sparky" ~ "2020-08-12",
                                name == "Stanley" ~ "2020-08-12",
                                name == "Lily" ~ "2020-12-11",
                                name == "Leo" ~ "2020-12-11",
                                name == "Jack" ~ "2020-12-11"))
#make DOB in date format
newdf$DOB <- as.Date(newdf$DOB, format= "%Y-%m-%d")

# exact weeks / age column
newdf<-newdf %>% mutate(exactage =
                       difftime(Date, DOB, units="weeks"))
#make weeks old column (rounded)
newdf<-newdf%>% mutate(weeksold =
                         case_when(exactage >= 8 & exactage < 9 ~8,
                                   exactage >= 9 & exactage < 10 ~9,
                                   exactage >= 10 & exactage < 11 ~10,
                                   exactage >= 11 & exactage < 12 ~11,
                                   exactage >= 12 & exactage < 13 ~12,
                                   exactage >= 13 & exactage < 14 ~13,
                                   exactage >= 14 & exactage < 15 ~14,
                                   exactage >= 15 & exactage < 16 ~15,
                                   exactage >= 16 & exactage < 17 ~16,
                                   exactage >= 17 & exactage < 18 ~17,
                                   exactage >= 18 & exactage < 19 ~18,
                                   exactage >= 19 & exactage < 20 ~19,
                                   exactage >= 20 ~20,)) 

#adding rearing column (home based vs. DPK) 
#note: Spring 2020 puppies are "home-based" from 8-10 weeks
newdf<-newdf %>% mutate(rearing =
                          case_when(name == "Anya" ~ "DPK",
                                    name == "Aries" ~ "DPK",
                                    name == "Weston" ~ "DPK",
                                    name == "Ying" ~ "DPK",
                                    name == "Yolanda" ~ "DPK",
                                    name == "Zina" ~ "DPK",
                                    name == "Zax" ~ "DPK",
                                    name == "Arthur" & Date <"2020-02-17"  ~ "home",
                                    name == "Arthur" & Date >="2020-02-17" ~ "DPK",
                                    name == "Aurora" & Date <"2020-02-17"  ~ "home",
                                    name == "Aurora" & Date >="2020-02-17" ~ "DPK",
                                    name == "Westley" & Date <"2020-02-17"  ~ "home",
                                    name == "Westley" & Date >="2020-02-17" ~ "DPK",
                                    name == "Wisdom" & Date <"2020-02-17"  ~ "home",
                                    name == "Wisdom" & Date >="2020-02-17" ~ "DPK",
                                    name == "Yonder" & Date <"2020-02-17"  ~ "home",
                                    name == "Yonder" & Date >="2020-02-17" ~ "DPK",
                                    name == "Zindel" & Date <"2020-02-17"  ~ "home",
                                    name == "Zindel" & Date >="2020-02-17" ~ "DPK",
                                    name == "Zola" & Date <"2020-02-17"  ~ "home",
                                    name == "Zola" & Date >="2020-02-17" ~ "DPK",
                                    name == "Kristoff" ~ "home",
                                    name == "Barley" ~ "home",
                                    name == "Rainbow" ~ "home",
                                    name == "Sassy" ~ "home",
                                    name == "Sparky" ~ "home",
                                    name == "Stanley" ~ "home",
                                    name == "Lily" ~ "home",
                                    name == "Leo" ~ "home",
                                    name == "Jack" ~ "home"))
#adding sex column 
newdf<-newdf %>% mutate(sex =
                          case_when(name == "Anya" ~ "F",
                                    name == "Aries" ~ "M",
                                    name == "Weston" ~ "M",
                                    name == "Ying" ~ "M",
                                    name == "Yolanda" ~ "F",
                                    name == "Zina" ~ "F",
                                    name == "Zax" ~ "M",
                                    name == "Arthur" ~ "M",
                                    name == "Aurora" ~ "F",
                                    name == "Westley" ~ "M",
                                    name == "Wisdom" ~ "F",
                                    name == "Yonder" ~ "F",
                                    name == "Zola" ~ "F",
                                    name == "Zindel" ~ "M",
                                    name == "Kristoff" ~ "M",
                                    name == "Barley" ~ "M",
                                    name == "Rainbow" ~ "F",
                                    name == "Sassy" ~ "F",
                                    name == "Sparky" ~ "M",
                                    name == "Stanley" ~ "M",
                                    name == "Lily" ~ "F",
                                    name == "Leo" ~ "M",
                                    name == "Jack" ~ "M"))

```
Make hour column 
```{r, cache=TRUE}
newdf<-newdf %>% mutate(hour=
                         (hour(time)))
```
Make combined column for date and time
```{r, cache=TRUE}
newdf <- newdf %>% mutate(datetime=as.POSIXct(paste(Date,time), format="%Y-%m-%d %H:%M:%S"))
```
Create 5 minute intervals labels
```{r, cache=TRUE, eval=FALSE}
newdf <- newdf %>% mutate(interval=cut(newdf$datetime, breaks = "5 min"))
newdf <- newdf %>% mutate(intervaltime=as.POSIXct(newdf$interval))
newdf <- newdf %>% mutate(intervaltime=format(newdf$interval, format = "%H:%M:%S"))

#turn interval into datetime class
newdf$intervaltime2<-strptime(newdf$intervaltime, format='%Y-%m-%d %H:%M:%S')

#make column "intervaltime" just for interval time
newdf$intervaltime<-strftime(newdf$intervaltime2, '%H:%M')
```
For each puppy, find an average of activity for each 5 minute interval (make one mean activity count for each interval)
```{r, cache=TRUE}
intervaldf<-newdf %>% 
     group_by(intervaltime,weeksold,name,rearing,sex) %>% 
   summarise(interval_avg_activity=mean(activity_counts))

intervaldf2<-newdf %>% 
     group_by(intervaltime,Date,weeksold,name,rearing,sex) %>% 
   summarise(interval_avg_activity=mean(activity_counts))
```
Deviance from weekly means (for each puppy) for each (5 min interval) data point (creates indiv_weekly_dev df)
```{r, cache=TRUE}
#means for each puppy for each week of age
weeklymeanforage_bypuppy<-intervaldf %>% group_by(name, weeksold) %>% 
  summarize("weeklymeanforage_bypuppy"=mean(interval_avg_activity), N=n()) 
# merge two data frames: weekly mean for each puppy and hourly mean
#places each weekly mean next to its corresponding interval data point
indiv_weekly_dev<- merge(intervaldf,weeklymeanforage_bypuppy,by=c("name","weeksold"))
#deviance from the weekly mean (for each puppy) for each (5 min interval) data point 
indiv_weekly_dev<-indiv_weekly_dev %>% mutate(meandeviance=(interval_avg_activity-weeklymeanforage_bypuppy))
```
Find an average of activity for each week for each 5 minute interval (make one mean activity count for each interval) (not by puppy, for the entire group)
```{r}
weeklyintervaldf<-indiv_weekly_dev %>% 
     group_by(intervaltime,weeksold) %>% 
   summarise(interval_avg_deviance=mean(meandeviance),
             interval_weekly_avg=mean(interval_avg_activity))
```


---
#PLOTTING ACTIVITY
Setup
---
Store weeks old as a factor 
```{r}
weeklyintervaldf$weeksold<-as.factor(weeklyintervaldf$weeksold)
indiv_weekly_dev$weeksold<-as.factor(indiv_weekly_dev$weeksold)
```
List of desired hourly time breaks for graph x axis tick marks
```{r}
hours_list<-c("08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00")
```

  #MEAN DEVIANCE GRAPHS
---
INDIVIDUAL GRAPHS FOR 1 INDIVIDUAL PUPPY FOR 1 INDIVIDUAL WEEK
```{r}
#Leo, 8 weeks
ggplot(subset(indiv_weekly_dev,weeksold=="8" & name=="Leo"), aes(x=intervaltime, y=meandeviance, group=1)) + ylim(-500,2500) + geom_line() + ggtitle("Leo: 8 weeks") + xlab("Time") + ylab("Activity Counts (mean deviance)") + labs(colour = "Age (weeks)") +
  scale_x_discrete(breaks=hours_list)
```
GRAPH OF MEAN DEVIANCE (GROUPED BY PUPPY) FOR 1 SPECIFIC WEEK
```{r}
ggplot(subset(indiv_weekly_dev,weeksold=="8"), aes(x=intervaltime, y=meandeviance, group='name')) + geom_line(aes(colour=name)) + ggtitle("Mean Deviance: 8 weeks") + xlab("Time")+ ylab("Mean Deviance") + labs(colour = "Puppy") + scale_x_discrete(breaks=hours_list)
```
COMPARE TWO PUPPIES' MEAN DEVIANCE FOR 1 SPECIFIC WEEK
```{r}
ggplot(subset(indiv_weekly_dev,name=="Rainbow"&weeksold==12|name=="Stanley"&weeksold==12), aes(x=intervaltime, y=meandeviance, group=name)) + geom_line(aes(colour=name)) + ggtitle("Mean Deviance: 12 weeks") + xlab("Time")+ ylab("Mean Deviance") + labs(colour = "Puppy") + scale_x_discrete(breaks=hours_list)
```
GROUP AVG FOR 1 INDIVIDUAL WEEK
```{r}
#8 weeks
ggplot(subset(weeklyintervaldf,weeksold=="8"), aes(x=intervaltime, y=interval_avg_deviance, group=1)) + geom_line() + ggtitle("Group: 8 weeks") + xlab("Time") + ylab("Activity Counts (mean deviance)") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)
```
GRAPHS OF ALL WEEKS OVERLAID (USING ENTIRE GROUP MEAN DEVIANCE)
```{r}
ggplot(weeklyintervaldf, aes(x=intervaltime, y=interval_avg_deviance, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Group: 8-20 weeks") + xlab("Time")+ ylab("Activity Counts (mean deviance)") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)
```
GRAPHS OF ALL WEEKS FOR 1 INDIVIDUAL PUPPY 
```{r}
ggplot(subset(indiv_weekly_dev,name=="Rainbow"), aes(x=intervaltime, y=meandeviance, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Rainbow: 8-20 weeks") + xlab("Time") + ylab("Activity Counts (mean deviance)") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)
```

GRAPHS OF GROUP DEVIANCE: 8 VS 20 WEEKS
```{r}
ggplot((subset(weeklyintervaldf,weeksold=="8" | weeksold=="20")), aes(x=intervaltime, y=interval_avg_deviance, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Group: 8 vs. 20 weeks") + xlab("Time") + ylab("Activity Counts (mean deviance)") +ylab("Activity Counts (mean deviance)") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)

```
GRAPHS OF GROUP DEVIANCE: 8, 14, & 20 WEEKS
```{r}
ggplot((subset(weeklyintervaldf,weeksold=="8" | weeksold=="14"| weeksold=="20")), aes(x=intervaltime, y=interval_avg_deviance, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Group: 8, 14, & 20 weeks") + xlab("Time") + ylab("Activity Counts (mean deviance)") +ylab("Activity Counts (mean deviance)") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)

```


  #MEAN ACTIVITY COUNT GRAPHS (raw mean activity, not deviance)
---
INDIVIDUAL GRAPH OF RAW (MEAN) ACTIVITY COUNTS FOR 1 INDIVIDUAL PUPPY FOR 1 INDIVIDUAL WEEK
```{r}
#Arthur, 8 weeks
#can add ylim(-500,2500)
ggplot(subset(intervaldf,weeksold=="8" & name=="Sassy"), aes(x=intervaltime, y=interval_avg_activity, group=1)) + geom_line() + ggtitle("Arthur: 8 weeks") + xlab("Time") + ylab("Mean Activity Counts") + labs(colour = "Age (weeks)") +
  scale_x_discrete(breaks=hours_list)
```
GRAPH OF RAW (MEAN) ACTIVITY COUNTS GROUPED BY PUPPY) FOR 1 SPECIFIC WEEK
```{r}
ggplot(subset(intervaldf,weeksold=="8"), aes(x=intervaltime, y=interval_avg_activity, group='name')) + geom_line(aes(colour=name)) + ggtitle("Group Activity Counts: 8 weeks") + xlab("Time")+ ylab("Mean Activity Counts") + labs(colour = "Puppy") + scale_x_discrete(breaks=hours_list)

ggplot(subset(intervaldf,weeksold=="18"), aes(x=intervaltime, y=interval_avg_activity, group='name')) + geom_line(aes(colour=name)) + ggtitle("Group Activity Counts: 18 weeks") + xlab("Time")+ ylab("Mean Activity Counts") + labs(colour = "Puppy") + scale_x_discrete(breaks=hours_list)
```
COMPARE TWO PUPPIES' RAW MEAN ACTIVITY COUNTS FOR 1 SPECIFIC WEEK
```{r}
###graph is now fixed!
ggplot(subset(intervaldf,name=="Sassy"&weeksold==8|name=="Arthur"&weeksold==8), aes(x=intervaltime, y=interval_avg_activity, group=name)) + geom_line(aes(colour=name)) + ggtitle("Mean Activity Counts: 8 weeks") + xlab("Time")+ ylab("Mean Activity Counts") + labs(colour = "Puppy") + scale_x_discrete(breaks=hours_list)
```
GROUP AVG OF RAW (MEAN) ACTIVITY COUNTS FOR 1 INDIVIDUAL WEEK
```{r}
#8 weeks
ggplot(subset(weeklyintervaldf,weeksold=="8"), aes(x=intervaltime, y=interval_weekly_avg, group=1)) + geom_line() + ggtitle("Group: 8 weeks") + xlab("Time") + ylab("Mean Activity Counts") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)

#20 weeks
ggplot(subset(weeklyintervaldf,weeksold=="20"), aes(x=intervaltime, y=interval_weekly_avg, group=1)) + geom_line() + ggtitle("Group: 20 weeks") + xlab("Time") + ylab("Mean Activity Counts") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)
```
GRAPHS OF ALL WEEKS OVERLAID (USING ENTIRE GROUP RAW MEAN ACTIVITY COUNTS)
```{r}
ggplot(weeklyintervaldf, aes(x=intervaltime, y=interval_weekly_avg, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Group: 8-20 weeks") + xlab("Time")+ ylab("Mean Activity Counts") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)
```
GRAPHS OF GROUP: 8 VS 20 WEEKS (RAW MEAN ACTIVITY COUNTS)
```{r}
ggplot((subset(weeklyintervaldf,weeksold=="8" | weeksold=="20")), aes(x=intervaltime, y=interval_weekly_avg, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Group: 8 vs. 20 weeks") + xlab("Time") + ylab("Mean Activity Counts") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)

```
GRAPHS OF GROUP: 8, 14, & 20 WEEKS
```{r}
ggplot((subset(weeklyintervaldf,weeksold=="8" | weeksold=="14"| weeksold=="20")), aes(x=intervaltime, y=interval_weekly_avg, group=weeksold)) + geom_line(aes(colour=weeksold)) + ggtitle("Group: 8, 14, & 20 weeks") + xlab("Time") + ylab("Mean Activity Counts") + labs(colour = "Age (weeks)") + scale_x_discrete(breaks=hours_list)

```




---
#CALCULATE SLEEP BOUTS
---
Rest/wake thresholds
```{r, cache=TRUE}
#set threshold for sleeping/awake
sleepbouts<-indiv_weekly_dev %>% mutate(state=case_when(interval_avg_activity >= 100 ~ "awake",interval_avg_activity <100 ~ "rest"))

sleepbouts_200<-indiv_weekly_dev %>% mutate(state=case_when(interval_avg_activity >= 100 ~ "awake",interval_avg_activity <100 ~ "rest"))


#make column for interval end time 
library(lubridate)
sleepbouts <-sleepbouts %>% mutate(intervaltime2=as.POSIXct(intervaltime, format="%H:%M"))
sleepbouts <-sleepbouts %>% mutate(intervalend=(intervaltime2+(5*60)))
sleepbouts <-sleepbouts %>% mutate(intervalend=strftime(intervalend, format="%H:%M")) 
sleepbouts <-sleepbouts %>% select(-intervaltime2)

#assign group numbers to unique sleep periods
sleepbouts<-sleepbouts %>% 
  mutate(timeperiod = hm(intervaltime),
         timeperiod_end = hm(intervalend)) %>%
  group_by(name,weeksold) %>% 
  arrange(intervaltime) %>% 
  mutate (group = data.table::rleid(state))

#threshold = 200
sleepbouts_200<-indiv_weekly_dev %>% mutate(state=case_when(interval_avg_activity >= 200 ~ "awake",interval_avg_activity <200 ~ "rest"))
sleepbouts_200 <-sleepbouts_200 %>% mutate(intervaltime2=as.POSIXct(intervaltime, format="%H:%M"))
sleepbouts_200 <-sleepbouts_200 %>% mutate(intervalend=(intervaltime2+(5*60)))
sleepbouts_200 <-sleepbouts_200 %>% mutate(intervalend=strftime(intervalend, format="%H:%M")) 
sleepbouts_200 <-sleepbouts_200 %>% select(-intervaltime2)
sleepbouts_200<-sleepbouts_200 %>% 
  mutate(timeperiod = hm(intervaltime),
         timeperiod_end = hm(intervalend)) %>%
  group_by(name,weeksold) %>% 
  arrange(intervaltime) %>% 
  mutate (group = data.table::rleid(state))

view(sleepbouts)
```

Intervals of resting and wakefulness
```{r, cache=TRUE, eval=FALSE}
sleepbout_intervals<-sleepbouts %>% 
  group_by(name,weeksold,group) %>% 
  summarise(intervaltime = paste(first(intervaltime), last(intervalend), sep = '-'), 
            state = first(state), 
            timeperiod = last(timeperiod_end) - first(timeperiod))

#Convert timeperiod class to minutes
library(lubridate)
sleepbout_intervals<-sleepbout_intervals %>% mutate(timeperiod_secs=time_length(timeperiod),
                                     timeperiod_mins=timeperiod_secs/60) %>% 
  select(-timeperiod_secs)

view(sleepbout_intervals)

#Find average & total length of rest vs awake states for each week
sleepbout_weeklyavg <- sleepbout_intervals %>% group_by(weeksold,state) %>% 
  summarize(Mean_mins=mean(timeperiod_mins), N=n(),Total_mins=sum(timeperiod_mins))
view(sleepbout_weeklyavg)
```

Calculate rest/wake duration (avg and total) for each puppy for each week, add rearing & sex info
```{r, cache=TRUE, eval=FALSE}
sleepbout_weeklyavg_bypuppy <- sleepbout_intervals %>% group_by(weeksold,name,state) %>% 
  summarize(Mean_mins=mean(timeperiod_mins), N=n(),Total_mins=sum(timeperiod_mins))

sleepbout_weeklyavg_bypuppy$weeksold<-as.character(sleepbout_weeklyavg_bypuppy$weeksold)
sleepbout_weeklyavg_bypuppy<-sleepbout_weeklyavg_bypuppy %>% mutate(rearing =
                          sleepbout_weeklyavg_bypuppy2$weeksold<-as.character(sleepbout_weeklyavg_bypuppy2$weeksold)
sleepbout_weeklyavg_bypuppy2<-sleepbout_weeklyavg_bypuppy2 %>% mutate(rearing =
                          case_when(name == "Anya" ~ "DPK",
                                    name == "Aries" ~ "DPK",
                                    name == "Weston" ~ "DPK",
                                    name == "Ying" ~ "DPK",
                                    name == "Yolanda" ~ "DPK",
                                    name == "Zina" ~ "DPK",
                                    name == "Zax" ~ "DPK",
                                    (name == "Arthur" & weeksold <10) ~ "home",
                                    (name == "Arthur" & weeksold ==10) ~ "DPK",
                                    (name == "Arthur" & weeksold >10) ~ "DPK",
                                    (name == "Aurora" & weeksold <10)  ~ "home",
                                    (name == "Aurora" & weeksold ==10) ~ "DPK",
                                    (name == "Aurora" & weeksold >10) ~ "DPK",
                                    (name == "Westley" & weeksold <10) ~ "home",
                                    (name == "Westley" & weeksold ==10) ~ "DPK",
                                    (name == "Westley" & weeksold >10) ~ "DPK",
                                    (name == "Wisdom" & weeksold <10)  ~ "home",
                                    (name == "Wisdom" & weeksold ==10) ~ "DPK",
                                    (name == "Wisdom" & weeksold >10) ~ "DPK",
                                    (name == "Yonder" & weeksold <10)  ~ "home",
                                    (name == "Yonder" & weeksold ==10) ~ "DPK",
                                    (name == "Yonder" & weeksold >10) ~ "DPK",
                                    (name == "Zindel" & weeksold <10)  ~ "home",
                                    (name == "Zindel" & weeksold ==10) ~ "DPK",
                                    (name == "Zindel" & weeksold >10) ~ "DPK",
                                    (name == "Zola" & weeksold <10)  ~ "home",
                                    (name == "Zola" & weeksold ==10) ~ "DPK",
                                    (name == "Aurora" & weeksold >10) ~ "DPK",
                                    name == "Kristoff" ~ "home",
                                    name == "Barley" ~ "home",
                                    name == "Rainbow" ~ "home",
                                    name == "Sassy" ~ "home",
                                    name == "Sparky" ~ "home",
                                    name == "Stanley" ~ "home",
                                    name == "Lily" ~ "home",
                                    name == "Leo" ~ "home",
                                    name == "Jack" ~ "home"),
                          sex=case_when(name == "Anya" ~ "F",
                                    name == "Aries" ~ "M",
                                    name == "Weston" ~ "M",
                                    name == "Ying" ~ "M",
                                    name == "Yolanda" ~ "F",
                                    name == "Zina" ~ "F",
                                    name == "Zax" ~ "M",
                                    name == "Arthur" ~ "M",
                                    name == "Aurora" ~ "F",
                                    name == "Westley" ~ "M",
                                    name == "Wisdom" ~ "F",
                                    name == "Yonder" ~ "F",
                                    name == "Zola" ~ "F",
                                    name == "Zindel" ~ "M",
                                    name == "Kristoff" ~ "M",
                                    name == "Barley" ~ "M",
                                    name == "Rainbow" ~ "F",
                                    name == "Sassy" ~ "F",
                                    name == "Sparky" ~ "M",
                                    name == "Stanley" ~ "M",
                                    name == "Lily" ~ "F",
                                    name == "Leo" ~ "M",
                                    name == "Jack" ~ "M"))
sleepbout_weeklyavg_bypuppy$weeksold<-as.numeric(as.character(sleepbout_weeklyavg_bypuppy$weeksold))

view(sleepbout_weeklyavg_bypuppy)
```
Compare home vs. DPK pups
```{r, cache=TRUE}
sleepbout_weeklyavg_rearing <- sleepbout_weeklyavg_bypuppy %>% group_by(weeksold,state,rearing) %>% summarize(Mean_mins=mean(Mean_mins), N=n(),Total_mins=sum(Total_mins)) 
sleepbout_weeklyavg_rearing$weeksold<-as.numeric(as.character(sleepbout_weeklyavg_rearing$weeksold))
```

Without collapsing across days:
```{r, cache=TRUE, eval=FALSE}
#set threshold for sleeping/awake
sleepbouts2<-intervaldf2 %>% mutate(state=case_when(interval_avg_activity >= 100 ~ "awake",interval_avg_activity <100 ~ "rest"))

#make column for interval end time 
library(lubridate)
sleepbouts2 <-sleepbouts2 %>% mutate(intervaltime2=as.POSIXct(intervaltime, format="%H:%M"))
sleepbouts2 <-sleepbouts2 %>% mutate(intervalend=(intervaltime2+(5*60)))
sleepbouts2 <-sleepbouts2 %>% mutate(intervalend=strftime(intervalend, format="%H:%M")) 
sleepbouts2 <-sleepbouts2 %>% select(-intervaltime2)

#assign group numbers to unique sleep periods
sleepbouts2<-sleepbouts2 %>% 
  mutate(timeperiod = hm(intervaltime),
         timeperiod_end = hm(intervalend)) %>%
  group_by(name,weeksold) %>% 
  arrange(Date,name, intervaltime) %>% 
  mutate (group = data.table::rleid(state))

view(sleepbouts2)

#Intervals of resting and wakefulness for each **DAY**
sleepbout_intervals2<-sleepbouts2 %>% 
  group_by(name,Date,weeksold,group) %>% 
  summarise(intervaltime = paste(first(intervaltime), last(intervalend), sep = '-'), 
            state = first(state), 
            timeperiod = last(timeperiod_end) - first(timeperiod))

library(lubridate)
sleepbout_intervals2<-sleepbout_intervals2 %>% mutate(timeperiod_secs=time_length(timeperiod),
                                     timeperiod_mins=timeperiod_secs/60) %>% select(-timeperiod_secs)
####start here
#collapse to get average in each interval per week
sleepbout_intervals2_collapsed_bypuppy<-sleepbout_intervals2 %>% group_by(weeksold,name,intervaltime,state) %>%summarise(interval_avg_activity=mean(timeperiod_mins))

sleepbout_intervals2_collapsed<-sleepbout_intervals2 %>% group_by(weeksold,intervaltime,state) %>%summarise(interval_avg_activity=mean(timeperiod_mins))


sleepbout_weeklyavg2 <- sleepbout_intervals2 %>% group_by(weeksold,state) %>%
  summarize(Mean_mins=mean(timeperiod_mins), N=n(),Total_mins=sum(timeperiod_mins))

sleepbout_weeklyavg_bypuppy2 <- sleepbout_intervals2 %>% group_by(weeksold,name,state) %>% 
  summarize(Mean_mins=mean(timeperiod_mins), N=n(),Total_mins=sum(timeperiod_mins))

sleepbout_weeklyavg_bypuppy2$weeksold<-as.character(sleepbout_weeklyavg_bypuppy2$weeksold)
sleepbout_weeklyavg_bypuppy2<-sleepbout_weeklyavg_bypuppy2 %>% mutate(rearing =
                          case_when(name == "Anya" ~ "DPK",
                                    name == "Aries" ~ "DPK",
                                    name == "Weston" ~ "DPK",
                                    name == "Ying" ~ "DPK",
                                    name == "Yolanda" ~ "DPK",
                                    name == "Zina" ~ "DPK",
                                    name == "Zax" ~ "DPK",
                                    (name == "Arthur" & weeksold <10) ~ "home",
                                    (name == "Arthur" & weeksold ==10) ~ "DPK",
                                    (name == "Arthur" & weeksold >10) ~ "DPK",
                                    (name == "Aurora" & weeksold <10)  ~ "home",
                                    (name == "Aurora" & weeksold ==10) ~ "DPK",
                                    (name == "Aurora" & weeksold >10) ~ "DPK",
                                    (name == "Westley" & weeksold <10) ~ "home",
                                    (name == "Westley" & weeksold ==10) ~ "DPK",
                                    (name == "Westley" & weeksold >10) ~ "DPK",
                                    (name == "Wisdom" & weeksold <10)  ~ "home",
                                    (name == "Wisdom" & weeksold ==10) ~ "DPK",
                                    (name == "Wisdom" & weeksold >10) ~ "DPK",
                                    (name == "Yonder" & weeksold <10)  ~ "home",
                                    (name == "Yonder" & weeksold ==10) ~ "DPK",
                                    (name == "Yonder" & weeksold >10) ~ "DPK",
                                    (name == "Zindel" & weeksold <10)  ~ "home",
                                    (name == "Zindel" & weeksold ==10) ~ "DPK",
                                    (name == "Zindel" & weeksold >10) ~ "DPK",
                                    (name == "Zola" & weeksold <10)  ~ "home",
                                    (name == "Zola" & weeksold ==10) ~ "DPK",
                                    (name == "Aurora" & weeksold >10) ~ "DPK",
                                    name == "Kristoff" ~ "home",
                                    name == "Barley" ~ "home",
                                    name == "Rainbow" ~ "home",
                                    name == "Sassy" ~ "home",
                                    name == "Sparky" ~ "home",
                                    name == "Stanley" ~ "home",
                                    name == "Lily" ~ "home",
                                    name == "Leo" ~ "home",
                                    name == "Jack" ~ "home"),
                          sex=case_when(name == "Anya" ~ "F",
                                    name == "Aries" ~ "M",
                                    name == "Weston" ~ "M",
                                    name == "Ying" ~ "M",
                                    name == "Yolanda" ~ "F",
                                    name == "Zina" ~ "F",
                                    name == "Zax" ~ "M",
                                    name == "Arthur" ~ "M",
                                    name == "Aurora" ~ "F",
                                    name == "Westley" ~ "M",
                                    name == "Wisdom" ~ "F",
                                    name == "Yonder" ~ "F",
                                    name == "Zola" ~ "F",
                                    name == "Zindel" ~ "M",
                                    name == "Kristoff" ~ "M",
                                    name == "Barley" ~ "M",
                                    name == "Rainbow" ~ "F",
                                    name == "Sassy" ~ "F",
                                    name == "Sparky" ~ "M",
                                    name == "Stanley" ~ "M",
                                    name == "Lily" ~ "F",
                                    name == "Leo" ~ "M",
                                    name == "Jack" ~ "M"))
sleepbout_weeklyavg_bypuppy2$weeksold<-as.numeric(as.character(sleepbout_weeklyavg_bypuppy2$weeksold))

#Compare home vs. DPK pups
sleepbout_weeklyavg_rearing2 <- sleepbout_weeklyavg_bypuppy2 %>% group_by(weeksold,state,rearing) %>% summarize(Mean_mins=mean(Mean_mins), N=n(),Total_mins=sum(Total_mins)) 
sleepbout_weeklyavg_rearing$weeksold<-as.numeric(as.character(sleepbout_weeklyavg_rearing2$weeksold))
```


Threshold = 200, without collapsing across days
---
```{r}
#threshold = 200
sleepbouts_200_full<-intervaldf2 %>% mutate(state=case_when(interval_avg_activity >= 200 ~ "awake",interval_avg_activity <200 ~ "rest"))
sleepbouts_200_full <-sleepbouts_200_full %>% mutate(intervaltime2=as.POSIXct(intervaltime, format="%H:%M"))
sleepbouts_200_full <-sleepbouts_200_full %>% mutate(intervalend=(intervaltime2+(5*60)))
sleepbouts_200_full <-sleepbouts_200_full %>% mutate(intervalend=strftime(intervalend, format="%H:%M")) 
sleepbouts_200_full <-sleepbouts_200_full %>% select(-intervaltime2)
sleepbouts_200_full<-sleepbouts_200_full %>% 
  mutate(timeperiod = hm(intervaltime),
         timeperiod_end = hm(intervalend)) %>%
  group_by(name,weeksold) %>% 
  arrange(intervaltime) %>% 
  mutate (group = data.table::rleid(state))

#Intervals of resting and wakefulness for each **DAY**
sleepbout_intervals_full_200<-sleepbouts_200_full %>% 
  group_by(name,Date,weeksold,group) %>% 
  summarise(intervaltime = paste(first(intervaltime), last(intervalend), sep = '-'), 
            state = first(state), 
            timeperiod = last(timeperiod_end) - first(timeperiod))

library(lubridate)
sleepbout_intervals_full_200<-sleepbout_intervals_full_200 %>% mutate(timeperiod_secs=time_length(timeperiod),
                                     timeperiod_mins=timeperiod_secs/60) %>% select(-timeperiod_secs)

#collapse to get average in each interval per week
sleepbout_intervals_200_collapsed_bypuppy<-sleepbout_intervals_full_200 %>% group_by(weeksold,name,intervaltime,state) %>%summarise(interval_avg_activity=mean(timeperiod_mins))

sleepbout_intervals_200_collapsed<-sleepbout_intervals_full_200 %>% group_by(weeksold,intervaltime,state) %>%summarise(interval_avg_activity=mean(timeperiod_mins))

#here

sleepbout_weeklyavg_full_200 <- sleepbout_intervals_200_collapsed %>% group_by(weeksold,state) %>%
  summarize(Mean_mins=mean(timeperiod_mins), N=n(),Total_mins=sum(timeperiod_mins))

sleepbout_weeklyavg_bypuppy_full_200 <- sleepbout_intervals_200_collapsed %>% group_by(weeksold,name,state) %>% 
  summarize(Mean_mins=mean(timeperiod_mins), N=n(),Total_mins=sum(timeperiod_mins))

sleepbout_intervals_200_collapsed_bypuppy$weeksold<-as.character(sleepbout_intervals_200_collapsed_bypuppy$weeksold)
sleepbout_intervals_200_collapsed_bypuppy<-sleepbout_intervals_200_collapsed_bypuppy %>% mutate(rearing =
                          case_when(name == "Anya" ~ "DPK",
                                    name == "Aries" ~ "DPK",
                                    name == "Weston" ~ "DPK",
                                    name == "Ying" ~ "DPK",
                                    name == "Yolanda" ~ "DPK",
                                    name == "Zina" ~ "DPK",
                                    name == "Zax" ~ "DPK",
                                    name == "Arthur" & weeksold <10 ~ "home",
                                    name == "Arthur" & weeksold ==10 ~ "DPK",
                                    name == "Arthur" & weeksold >10 ~ "DPK",
                                    name == "Aurora" & weeksold <10  ~ "home",
                                    name == "Aurora" & weeksold ==10 ~ "DPK",
                                    name == "Aurora" & weeksold >10 ~ "DPK",
                                    name == "Westley" & weeksold <10 ~ "home",
                                    name == "Westley" & weeksold ==10 ~ "DPK",
                                    name == "Westley" & weeksold >10 ~ "DPK",
                                    name == "Wisdom" & weeksold <10  ~ "home",
                                    name == "Wisdom" & weeksold ==10 ~ "DPK",
                                    name == "Wisdom" & weeksold >10 ~ "DPK",
                                    name == "Yonder" & weeksold <10  ~ "home",
                                    name == "Yonder" & weeksold ==10 ~ "DPK",
                                    name == "Yonder" & weeksold >10 ~ "DPK",
                                    name == "Zindel" & weeksold <10  ~ "home",
                                    name == "Zindel" & weeksold ==10 ~ "DPK",
                                    name == "Zindel" & weeksold >10 ~ "DPK",
                                    name == "Zola" & weeksold <10  ~ "home",
                                    name == "Zola" & weeksold ==10 ~ "DPK",
                                    name == "Aurora" & weeksold >10 ~ "DPK",
                                    name == "Kristoff" ~ "home",
                                    name == "Barley" ~ "home",
                                    name == "Rainbow" ~ "home",
                                    name == "Sassy" ~ "home",
                                    name == "Sparky" ~ "home",
                                    name == "Stanley" ~ "home",
                                    name == "Lily" ~ "home",
                                    name == "Leo" ~ "home",
                                    name == "Jack" ~ "home"),
                          sex=case_when(name == "Anya" ~ "F",
                                    name == "Aries" ~ "M",
                                    name == "Weston" ~ "M",
                                    name == "Ying" ~ "M",
                                    name == "Yolanda" ~ "F",
                                    name == "Zina" ~ "F",
                                    name == "Zax" ~ "M",
                                    name == "Arthur" ~ "M",
                                    name == "Aurora" ~ "F",
                                    name == "Westley" ~ "M",
                                    name == "Wisdom" ~ "F",
                                    name == "Yonder" ~ "F",
                                    name == "Zola" ~ "F",
                                    name == "Zindel" ~ "M",
                                    name == "Kristoff" ~ "M",
                                    name == "Barley" ~ "M",
                                    name == "Rainbow" ~ "F",
                                    name == "Sassy" ~ "F",
                                    name == "Sparky" ~ "M",
                                    name == "Stanley" ~ "M",
                                    name == "Lily" ~ "F",
                                    name == "Leo" ~ "M",
                                    name == "Jack" ~ "M"))
sleepbout_intervals_200_collapsed_bypuppy$weeksold<-as.numeric(as.character(sleepbout_intervals_200_collapsed_bypuppy$weeksold))

#Compare home vs. DPK pups
sleepbout_weeklyavg_rearing_full_200 <- sleepbout_weeklyavg_bypuppy_full_200 %>% group_by(weeksold,state,rearing) %>% summarize(Mean_mins=mean(Mean_mins), N=n(),Total_mins=sum(Total_mins)) 
sleepbout_weeklyavg_rearing_full_200$weeksold<-as.numeric(as.character(sleepbout_weeklyavg_rearing_full_200$weeksold))
```

---
#PLOTTING REST/WAKE BOUTS
---
  #FOR GROUP
Compare average rest/wake bout durations in 1 individual week
```{r}
ggplot(subset(sleepbout_weeklyavg,weeksold=="20"), aes(x=state, y=Mean_mins))+ geom_col(aes(fill=state)) + ggtitle("Average Sleep/Awake Bout Duration: 20 weeks") + xlab("State")+ ylab("Mean State Duration (min)") + labs(colour = "State")
```
Compare average rest/awake bout durations for each week
```{r}
ggplot(subset(sleepbout_weeklyavg,state=="awake"), aes(x=weeksold, y=Mean_mins))+ geom_col(aes(fill=weeksold)) + ggtitle("Avg Duration of Awake Bouts by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")

ggplot(subset(sleepbout_weeklyavg,state=="rest"), aes(x=weeksold, y=Mean_mins))+ geom_col(aes(fill=weeksold)) + ggtitle("Avg Duration of Rest Bouts by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")

```
Total Minutes of Rest by Week
```{r}
ggplot(subset(sleepbout_weeklyavg,state=="rest"), aes(x=weeksold, y=Total_mins))+ geom_col(aes(fill=weeksold)) + ggtitle("Average Total Rest by Week") + xlab("Weeks Old")+ ylab("Total Rest (min)") + labs(colour = "Age (weeks)")
```
AVG REST HOME VS. DPK 
```{r}
weeks<-c(8:20)

ggplot(subset(sleepbout_weeklyavg_rearing,state=="rest"), aes(x=weeksold, y=Mean_mins, colour=rearing, group=rearing)) + geom_point() + geom_line() + ggtitle("Avg Duration of Rest Bouts by Week: Home vs. DPK") + xlab("Weeks Old")+ ylab("Avg State Duration (min)") + labs(colour = "Rearing") + scale_x_continuous(breaks=weeks)

ggplot(subset(sleepbout_weeklyavg_rearing,state=="rest"), aes(x=weeksold, y=Total_mins, colour=rearing, group=rearing)) + geom_point() + geom_line() + ggtitle("Average Total Rest by Week: Home vs. DPK") + xlab("Weeks Old")+ ylab("Rest (mins)") + labs(colour = "Rearing") + scale_x_continuous(breaks=weeks)
```

#FOR GROUP WITHOUT COLLAPSING FIRST,threshold = 100
---
Compare average rest/wake bout durations in 1 individual week
```{r}
ggplot(subset(sleepbout_weeklyavg2,weeksold=="20"), aes(x=state, y=Mean_mins))+ geom_col(aes(fill=state)) + ggtitle("Average Sleep/Awake Bout Duration: 20 weeks") + xlab("State")+ ylab("Mean State Duration (min)") + labs(colour = "State")
```
Compare average rest/awake bout durations for each week
```{r}
sleepbout_weeklyavg2$weeksold<-as.factor(sleepbout_weeklyavg2$weeksold)
ggplot(subset(sleepbout_weeklyavg2,state=="awake"), aes(x=weeksold, y=Mean_mins))+ geom_col(aes(fill=weeksold)) + ggtitle("Avg Duration of Awake Bouts by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")

ggplot(subset(sleepbout_weeklyavg2,state=="rest"), aes(x=weeksold, y=Mean_mins))+ geom_col(aes(fill=weeksold)) + ggtitle("Avg Duration of Rest Bouts by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")

```
Total Minutes of Rest by Week
```{r}
ggplot(subset(sleepbout_weeklyavg2,state=="rest"), aes(x=weeksold, y=Total_mins))+ geom_col(aes(fill=weeksold)) + ggtitle("Average Total Rest by Week") + xlab("Weeks Old")+ ylab("Total Rest (min)") + labs(colour = "Age (weeks)")
```
AVG REST HOME VS. DPK 
```{r}
weeks<-c(8:20)

ggplot(subset(sleepbout_weeklyavg_rearing2,state=="rest"), aes(x=weeksold, y=Mean_mins, colour=rearing, group=rearing)) + geom_point() + geom_line() + ggtitle("Avg Duration of Rest Bouts by Week: Home vs. DPK") + xlab("Weeks Old")+ ylab("Avg State Duration (min)") + labs(colour = "Rearing") + scale_x_continuous(breaks=weeks)

ggplot(subset(sleepbout_weeklyavg_rearing2,state=="rest"), aes(x=weeksold, y=Total_mins, colour=rearing, group=rearing)) + geom_point() + geom_line() + ggtitle("Average Total Rest by Week: Home vs. DPK") + xlab("Weeks Old")+ ylab("Rest (mins)") + labs(colour = "Rearing") + scale_x_continuous(breaks=weeks)
```




#BY PUPPY
---
Bar graph: Mean State Duration for 1 puppy by weeks
```{r}
ggplot(subset(sleepbout_weeklyavg_bypuppy, name=="Leo"), aes(x=weeksold, y=Mean_mins))+ geom_col(aes(fill=state)) + ggtitle("Leo: Mean Rest State Duration by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")+ scale_x_continuous(breaks=weeks)
```
Line graph: Mean State Duration for 1 puppy by weeks
```{r}
ggplot(subset(sleepbout_weeklyavg_bypuppy, name=="Leo"), aes(x=weeksold, y=Mean_mins, group=state))+ geom_line(aes(colour=state)) + ggtitle("Leo: Mean Rest State Duration by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")+ scale_x_continuous(breaks=weeks)
```
Line graph: mean rest state duration by week for each puppy
```{r}
ggplot(subset(sleepbout_weeklyavg_bypuppy, state=="rest"), aes(x=weeksold, y=Mean_mins, group=name))+ geom_line(aes(colour=name)) + ggtitle("Mean Rest State Duration by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")+ scale_x_continuous(breaks=weeks)
```


#BY PUPPY WITHOUT COLLAPSING FIRST, threshold = 100
---
Bar graph: Mean State Duration for 1 puppy by weeks
```{r}
ggplot(subset(sleepbout_weeklyavg_bypuppy2, name=="Leo"), aes(x=weeksold, y=Mean_mins))+ geom_col(aes(fill=state)) + ggtitle("Leo: Mean Rest State Duration by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")+ scale_x_continuous(breaks=weeks)
```
Line graph: Mean State Duration for 1 puppy by weeks
```{r}
ggplot(subset(sleepbout_weeklyavg_bypuppy2, name=="Leo"), aes(x=weeksold, y=Mean_mins, group=state))+ geom_line(aes(colour=state)) + ggtitle("Leo: Mean Rest State Duration by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")+ scale_x_continuous(breaks=weeks)
```
Line graph: mean rest state duration by week for each puppy
```{r}
ggplot(subset(sleepbout_weeklyavg_bypuppy2, state=="rest"), aes(x=weeksold, y=Mean_mins, group=name))+ geom_line(aes(colour=name)) + ggtitle("Mean Rest State Duration by Week") + xlab("Weeks Old")+ ylab("Mean State Duration (min)") + labs(colour = "Age (weeks)")+ scale_x_continuous(breaks=weeks)
```




#EXPORT   
---
EXPORT dfs individually
```{r, eval=FALSE, echo=FALSE}
#######EXPORT
library(openxlsx)
require(openxlsx)
write.xlsx(indiv_weekly_dev, file = "individual weekly means.xlsx")

library(openxlsx)
require(openxlsx)
write.xlsx(weeklyintervaldf, file = "group weekly means.xlsx")

```
EXPORT dfs as sheets on one doc
```{r, eval=FALSE, echo=FALSE}
#######EXPORT

#convert grouped dfs into dataframes to be able to export 

sorted_by_puppy_means<-as.data.frame(sorted_by_puppy_means)
sorted_by_age_means<-as.data.frame(sorted_by_age_means)
by_rearing_total<-as.data.frame(by_rearing_total)
by_rearing_means<-as.data.frame(by_rearing_means)
by_sex_total<-as.data.frame(by_sex_total)
by_sex_weekly_means<-as.data.frame(by_sex_weekly_means)

library(openxlsx)
require(openxlsx)
test <- list(age_group_means = age_group_means, 
             sorted_by_puppy_means = sorted_by_puppy_means,
             sorted_by_age_means = sorted_by_age_means,
             by_rearing_total = by_rearing_total,
             by_rearing_means = by_rearing_means,
             by_sex_total = by_sex_total,
             by_sex_weekly_means = by_sex_weekly_means,
             by_hour = by_hour,
             by_hour_weekly=by_hour_weekly,
             by_hour_weekly_puppy=by_hour_weekly_puppy
             )
write.xlsx(test, file = "puppyactivitymeans2.xlsx")

```

